---
title: "Stranger Things Dialogue"
author: "Martijn van Bloois"
date: "2022-10-18"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE)
```

```{r}
topic <- "Stranger-Things"
year <- 2022
week <- 42
yrwk <- glue::glue("{year}-{week}")
plots_dir <- paste0(year, "-", week)
fs::dir_create(here::here("plots", plots_dir))
png_file <- glue::glue("{yrwk}_{topic}.png")
pdf_file <- glue::glue("{yrwk}_{topic}.pdf")
```

```{r}
suppressMessages(library(tidyverse))
library(lubridate)
library(patchwork)
library(scales)
library(showtext)
library(prismatic)
``` 

```{r}
font_add_google(name = "Stylish", family = "stylish")
showtext_opts(dpi = 300)
showtext_auto(enable = TRUE)
```


```{r}
tuesdata <- tidytuesdayR::tt_load(2022, week = 42)

episodes <- tuesdata$episodes
dialogues <- tuesdata$stranger_things_all_dialogue
rm(tuesdata)
```

```{r}
library(tidytext)

dialogues_cleaned <- dialogues %>% 
  filter(!is.na(dialogue)) %>% 
  unnest_tokens(word, dialogue) %>% 
  mutate(index = strftime((ceiling_date(as_datetime(start_time), unit = "5 minutes")), format = "%H:%M", tz = "GMT")) %>% 
  mutate(se = glue::glue("S0{season}E0{episode}")) %>% 
  count(se, index) 
  
dialogues_cleaned %>% 
  ggplot(aes(x = index, y = n, group = se)) +
  geom_line(aes(colour = se))


```

```{r}


  
dialogues_cleaned %>% 
  count(word, sort = T)

positive <- get_sentiments("bing") %>%
  filter(sentiment == "positive")

negative <- get_sentiments("bing") %>%
  filter(sentiment == "negative")

dialogues_cleaned %>%
  semi_join(positive) %>%
  count(word, sort = TRUE)

dialogues_cleaned %>%
  semi_join(negative) %>%
  count(word, sort = TRUE)

bing <- get_sentiments("bing")

dialogues_cleaned %>% 
  group_by(season, episode) %>% 
  summarise(start = min(start_time),
            end = max(end_time))

stranger_sentiments <- dialogues_cleaned %>%
  inner_join(bing) %>%
  count(season, episode, index = line %/% 10, sentiment) %>%
  spread(sentiment, n, fill = 0) %>%
  mutate(sentiment = positive - negative)

stranger_sentiments

stranger_sentiments %>% 
  filter(season == 1) %>% 
  ggplot(aes(index, sentiment, fill = episode)) +
  geom_bar(stat = "identity", show.legend = FALSE) +
  facet_wrap(~episode, ncol = 2)
```


```{r}
pal <- c("#221738","#511466","#7a1a7a","#941a58","#3c7055","#078a52","#7ea334","#eb8b2a","#ebb30c")
```


```{r}
ggsave(here::here("plots", yrwk, pdf_file),
      width = 8, height = 7, dpi = 300,
      device = cairo_pdf)

ggsave(here::here("plots", yrwk, png_file),
      width = 8, height = 7, dpi = 300,
      device = "png")
```


