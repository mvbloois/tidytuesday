---
title: "Ferris Wheels"
author: "Martijn van Bloois"
date: "2022-08-09"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE)
```

```{r}
topic <- "Bigfoot"
year <- 2022
week <- 37
yrwk <- glue::glue("{year}-{week}")
plots_dir <- paste0(year, "-", week)
fs::dir_create(here::here("plots", plots_dir))
png_file <- glue::glue("{yrwk}_{topic}.png")
pdf_file <- glue::glue("{yrwk}_{topic}.pdf")
```

```{r}
suppressMessages(library(tidyverse))
library(lubridate)
library(ggdist)

library(scales)
library(ggtext)
library(showtext)
library(janitor)
library(sf)
library(tigris)
library(ggmap)
library(ggbump)

# register_google(key = "YOUR KEY HERE")
``` 

```{r}
font_add_google(name = "Dancing Script", family = "title-font")
font_add_google(name = "Cabin", family = "main-font")
showtext_opts(dpi = 300)
showtext_auto(enable = TRUE)
```

```{r}
bigfoot <- readr::read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-09-13/bfro_reports_geocoded.csv")

glimpse(bigfoot)
```

```{r}
bigfoot %>% 
  count(state, sort = TRUE)

state_county_n <- bigfoot %>% 
  count(state, county, sort = TRUE)

bigfoot %>% 
  count(season, sort = TRUE)

bigfoot %>% 
  count(classification, sort = TRUE)

bigfoot %>% 
  count(year(date))

bigfoot %>% 
  distinct(state, county) %>% 
  count(county, sort = T)
```



```{r}
states <- tigris::counties(class = "sf") %>% 
  select(STATEFP, STATENAME = NAME) %>% 
  as_tibble() %>% 
  select(-3)

us_counties <- tigris::counties(class = "sf", cb = TRUE) %>% 
  shift_geometry() %>% 
  filter(STATEFP < 60) %>% 
  inner_join(states, by = "STATEFP") %>% 
  left_join(state_county_n, by = c("STATENAME" = "state", "NAMELSAD" = "county"))
```

``` {r}
plt_map <- ggplot(us_counties) +
  geom_sf(size = 0.1) +
  geom_point(
    aes(colour = n, size = n, geometry = geometry),
    stat = "sf_coordinates",
    alpha = 0.7
  ) +
  scale_colour_gradient(position="bottom" , low = "blue", high = "red" 
                       )  +
  theme_void() +
  theme(plot.title = element_text(family = "title-font",
                                  size =  36,
                                  hjust = 0.5),
        plot.subtitle = element_text(family = "main-font",
                                  size =  20,
                                  hjust = 0.5),
        plot.caption =  element_text(family = "main-font",
                                  size =  14),
        plot.title.position = "plot",
        legend.position = "none",
        plot.background = element_rect(fill = "#F4F4F4",
                                       colour = NA))

bigfoot %>% 
  mutate(year = year(date)) %>% 
  distinct(state, year) %>% 
  filter(year >= 1980) %>% 
  drop_na() %>% 
  ggplot(aes(x = year, y = state)) +
  stat_halfeye(
    alpha = .6,
    n = 10000,
    adjust = .1, 
    trim = FALSE,
    color = NA,
    height = 1.5,
    justification = -.05
  ) +
  theme_minimal()
```

```{r}
plt_map

ggsave(here::here("plots", yrwk, pdf_file),
      width = 12, height = 8, dpi = 300,
      device = cairo_pdf)

ggsave(here::here("plots", yrwk, png_file),
      width = 12, height = 8, dpi = 300,
      device = "png")
```


